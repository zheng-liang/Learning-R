---
title: "Effects of Seasonality in Forecasting Singapore's Consumer Price Index"
author: "TAN Zheng Liang"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
    code_folding: show
---

```{r setup, include=FALSE}
knitr::knit_hooks$set(purl = knitr::hook_purl)
```

## 1 Introduction

In the project "[Forecasting Singapore CPI Using Different Time Series Models](https://tinyurl.com/bdzrkdsu)", I mentioned that I had ignored the effects of seasonality when estimating the current Consumer Price Index (CPI) of Singapore. In reality, seasonal patterns can be found in many different types of data, such as the total number of air passengers in a month over different seasons and monthly business activity during festive seasons. Accounting for such patterns may help to improve estimation of a variable using different models.

(To be finished last)

## 2 Packages Required

```{r load packages, message=FALSE, warning=FALSE}
# Use install.packages("packagename") if they are not already installed

# Packages that will be needed for obtaining data via an API
library(httr)
library(jsonlite)

# Packages that will be needed for the main parts of the project
library(ARDL) # For ARDL models lag selection
library(corrplot) # For visualizing correlation between variables
library(dLagM) # For creating ARDL objects that can work with a forecast function
library(foreach) # Foreach loops
library(forecast) # For ARIMA models, forecasting and evaluation
library(tidyverse) # For ggplot2 and dplyr
library(zoo) # For converting data to and working with zoo objects
```

## 3 Importing Data

The data used in this project is the same as the previous project. I imported the data from the Department of Statistics Singapore using an API and did the necessary data cleaning and manipulation. For a detailed explanation of how to import data using API and the data cleaning procedures, please see Section 3 and 4 of the previous project.

```{r import CPI data}
# Import Singapore Monthly Consumer Price Index 

cpi_url <- "https://tablebuilder.singstat.gov.sg/api/table/tabledata/M212881?isTestApi=true&seriesNoORrowNo=1"

raw_cpi <- httr::GET(url = cpi_url)

cpi_content <- jsonlite::fromJSON(rawToChar(raw_cpi$content))

cpi_data <- as.data.frame(cpi_content$Data$row$columns[[1]])

# order.by argument helps to sort the data in time ascending order
cpi <- zoo(x = cpi_data$value, order.by = as.yearmon(cpi_data$key, format = "%Y %b"))

# Values are of class "character", need to change them to numeric 
storage.mode(cpi) <- "numeric"

head(cpi); tail(cpi)
```

```{r import DSPI data}
# Import Singapore Monthly Domestic Supply Price Index

dspi_url <- "https://tablebuilder.singstat.gov.sg/api/table/tabledata/M212701?isTestApi=true&seriesNoORrowNo=1"

raw_dspi <- httr::GET(url = dspi_url)

dspi_content <- jsonlite::fromJSON(rawToChar(raw_dspi$content))

dspi_data <- as.data.frame(dspi_content$Data$row$columns[[1]])

dspi <- zoo(x = dspi_data$value, order.by = as.yearmon(dspi_data$key, format = "%Y  %b"))

storage.mode(dspi) <- "numeric"

head(dspi); tail(dspi)
```

```{r import CLI data}
# Import Singapore Quarterly Composite Leading Index

cli_url <- "https://tablebuilder.singstat.gov.sg/api/table/tabledata/M240421?isTestApi=true"

raw_cli <- httr::GET(url = cli_url)

cli_content <- jsonlite::fromJSON(rawToChar(raw_cli$content))

cli_data <- as.data.frame(cli_content$Data$row$columns[[1]])

cli <- zoo(x = cli_data$value, order.by = as.yearqtr(cli_data$key, format = "%Y %q"))

storage.mode(cli) <- "numeric"

head(cli); tail(cli)
```

## 4 Exploratory Data Analysis

In this section, I used some plots to visualize if there are any seasonal patterns in the CPI, DSPI and CLI data. Before that, I will need to create quarterly CPI and DSPI data from the monthly data and match the start and end periods of CLI since it has the lowest frequency and observations.

```{r quarterly CPI and DSPI data}
# Aggregate monthly data to quarterly data using mean value of the months in a quarter

cpi_q <- aggregate(cpi, as.yearqtr, mean)

dspi_q <- aggregate(dspi, as.yearqtr, mean)

# Adjust the sample size to match CLI data

cpi_q <- window(x = cpi_q, start = start(cli), end = end(cli))

head(cpi_q); tail(cpi_q)

dspi_q <- window(x = dspi_q, start = start(cli), end = end(cli))

head(dspi_q); tail(dspi_q)
```

Merge data into a single object:

```{r merge CPI DSPI and CLI}
data <- cbind(CPI = cpi_q, DSPI = dspi_q, CLI = cli)

head(data); dim(data)
```

To create a boxplot of grouped by the quarters, I would use the first-differenced data. This is because the CPI, DSPI and CLI series at level is not stationary and the boxplots I had plotted in my previous project is very likely to be erroneous. Furthermore, I would group the plots by several decades, starting from 1978Q1-1987Q4 and ending with 2008Q1-2017Q4, since the trends/patterns may vary across years.

Take first-difference on level data:

```{r difference data}
diff_data <- na.omit(diff(x = data, lag = 1, differences = 1)) %>% 
  `colnames<-`(c("dCPI", "dDSPI", "dCLI"))

head(diff_data); dim(diff_data)
```

### 4.1 Consumer Price Index

Plot level and differenced CPI series:

```{r plot of level and differenced CPI}
par(mfrow = c(2, 1))

plot(data$CPI, main = "Singapore Quarterly CPI from 1978Q1 to 2022Q1", ylab = "CPI")

plot(diff_data$dCPI, main = "Differenced CPI from 1978Q2 to 2022Q1", ylab = "dCPI")
```

Boxplot showing range of differenced CPI values in different quarters across different years:

```{r visually check for seasonality in dCPI}
startdates = c("1978Q1", "1988Q1", "1998Q1", "2008Q1")
enddates = c("1987Q4", "1997Q4", "2007Q4", "2017Q4")

par(mfrow = c(2, 2))

invisible(
foreach(i = startdates, j = enddates) %do% {
  
  boxplot(window(x = diff_data$dCPI, start = i, end = j) ~ cycle(window(x = diff_data$dCPI, start = i, end = j)),
          ylab = "Quarterly dCPI", xlab = "Quarters",
          main = paste(i, "to", j, sep = " "))
  
}
)
```

In each of the plot, we can see varying median values of differenced CPI in different quarters, which might indicate that seasonality is present in the CPI series. The seasonal patterns were also not constant, as the patterns over the quarters in each plot is different.




























## References


